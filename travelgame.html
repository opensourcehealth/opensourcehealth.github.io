<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Travelgame</title>
</head>
<link rel="icon" href="data:,">
<body>
<table>
<tr>
<th><canvas id="viewerCanvas" width="400" height="300" style="border:1px solid black"></canvas></th>
</tr>
</table>
<button type="button" onclick="update()">Update</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<select hidden="true" id="querySelect" onchange ="querySelectChanged()"></select>
<button hidden="true" id="newButton" onclick="windowNew()" type="button">New</button>
<a hidden="true" id="queryLink" href="index.html">Original Link</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<select id="pixelSelect" onchange ="pixelSelectChanged()"></select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<select id="scaleSelect" onchange ="scaleSelectChanged()"></select><br>
<textarea id="wordArea" rows="20" cols="120"></textarea><br>
<br>
<h3>XML</h3>
<textarea id="xmlArea" rows="40" cols="120"></textarea><br>
<br>
<br>
<script src="codec.js"></script>
<script src="help.js"></script>
<script src="maparray.js"></script>
<script src="matrix.js"></script>
<script src="parsenumber.js"></script>
<script src="parseword.js"></script>
<script src="statement.js"></script>
<script src="terrain.js"></script>
<script src="terrainviewer.js"></script>
<script>
//License = GNU Affero General Public License http://www.gnu.org/licenses/agpl.html
//
//Everything has getChildrenInBoundingBox(can be null), getSpeed(can be 0), id, image
//use bounding box for terrain
//add default terrain, character and region, get extraWater and temperature from region, view map=region, get flyer, resolution 1km move 6
//creating, drive, hiring, working, saving, trading
//building, repairing, learning, make earth map, hiding/stealing, lying/counterfeiting/forgery, taking, killing
//Asteroid, firestorm, volcano, flood, fish, plague, global warming, biodiversity
//view from flight, aerovator

function update() {
	updateSVGArea()
//	document.getElementById('paragraphText').innerHTML = xmlString
	setQueryStorage('newButton', 'querySelect', document.getElementById('wordArea').value)
}

function updateSVGArea() {
	var lines = getBracketReplacedLines('wordArea')
	var storageMap = new Map()
	storageMap.set('selectedEntity', null)
	storageMap.set('selectedRegion', null)
	var registry = {idMap:new Map(), objectMap:new Map(), storageMap:storageMap}
	terrainViewer.setID('viewerCanvas', registry.objectMap, 'pixelSelect', 'scaleSelect')
	var xmlStatement = getDocumentRoot(lines, 'xml')
	var descendants = [xmlStatement]
	addToDescendantsOutsideFirst(descendants, xmlStatement)
	for (var statement of descendants) {
		if (statement.tag != null) {
			registry.idMap.set(getStatementID(registry, statement), statement)
		}
	}
	var tagSet = new Set()
	for (var statement of descendants) {
		if (gTagMap.has(statement.tag)) {
			tagSet.add(statement.tag)
		}
	}
	if (!tagSet.has('region')) {
		xmlStatement.children.splice(0, 0, getStatement('region'))
	}
	if (!tagSet.has('creature')) {
		xmlStatement.children.splice(-2, 0, getStatement('creature'))
	}
	if (!tagSet.has('terrainViewer')) {
		xmlStatement.children.splice(-1, 0, getStatement('terrainViewer'))
	}
	createDefault(xmlStatement, registry)
	processDescendantsByTagMap(registry, xmlStatement, gTagMap)
	var descendants = [xmlStatement]
	addToDescendantsOutsideFirst(descendants, xmlStatement)
	if (registry.storageMap.has('group')) {
		width += registry.storageMap.get('group').scaledBorder
	}
	var xmlLines = getPassthroughLines(descendants, 'xml')
	var joinWord = getJoinWord()
	var xmlString = xmlLines.join(joinWord)
	setNumberOfRows('wordArea', lines)
	setNumberOfRows('xmlArea', xmlLines)
	document.getElementById('xmlArea').value = xmlString
	terrainViewer.start(registry.storageMap.get('terrainViewer.maximumHeight'))
	return xmlString
}

var gCapitalizationMap = new Map()
var gTagMap = new Map()
setProcessorMap(gTerrainProcessors, gTagMap)

setTextArea('wordArea')
update()
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8"/></head>
<body>
<script src="arraymath.js"></script>
<script src="maparray.js"></script>
<script src="alteration.js"></script>
<script src="construction.js"></script>
<script src="codec.js"></script>
<script src="evaluation.js"></script>
<script src="filesaver.js"></script>
<script src="function.js"></script>
<script src="help.js"></script>
<script src="generator2d.js"></script>
<script src="generator3d.js"></script>
<script src="lzstring.js"></script>
<script src="matrix.js"></script>
<script src="meta.js"></script>
<script src="parsenumber.js"></script>
<script src="parseword.js"></script>
<script src="pixel.js"></script>
<script src="polygon.js"></script>
<script src="polyhedron.js"></script>
<script src="statement.js"></script>
<script src="viewbroker.js"></script>
<script src="viewfractal2d.js"></script>
<script src="viewmesh.js"></script>
<script src="voxel.js"></script>
<script>
//License = GNU Affero General Public License http://www.gnu.org/licenses/agpl.html

const gPlanarColors = [[0,255,0], [0,255,0], [0,0,255], [0,0,255], [255,0,0], [255,0,0]]
// getUniqueIDByMonad, platonic, svg
// astronomy: gravity, temperature, day
// cell outline
// polygonJoin, brickwork
// outset point before fillet, outsetField
// fillet mesh
// view split, polygon, fractal
// make hinge given beginAngle, endAngle, overhangAngle, radius, holeRadius, width, gap
// upload
//
// split bent polygons
// maybe triangulateBentFacets vertically if possible
// check for unplanar polygons and triangulate
//
// test process join to handle matrix3Ds, omit origin
// ergonomic handle
// bevelZ
// make fastener
// make slot for socket
// row card pages
// upload
// after version 4 is printed, remove unused variables
//
// low priority
// test getEquation from fence and road
// arrayFunctionX
// polars
// rx/ry and superEllipse for regularPolygon
// arc ellipse from svg
// helix rotation
// if identical declared id is found post notice
// add notice if nothing is embossed, look beyond stratas
// add noticeByList for tags outside of alteration, meta, generator2d
// add notice for other missing and getStatementID whileIndex?
// bug when difference polygon point is on facet
// change remaining XY to 2D
// use warningByList instead of warning
// z set polygon points to z
// rename radius to inset or outset as applicable
// delete model select when models dropped and disabled in viewer
// replace null with undefined where appropriate especially when parsing
// view facet by normal
// speed up getClosestConnectionByFacets by searching first by closest to center of other polygon
// arcTo using more dotProducts instead of atan2
// rename bottomLeft to lowerLeft and topLeft to upperLeft
// use getSwapped2DPolygon instead of swapPolygon in pixel and voxel if there is a possibility of a loop overlap
// outset check for intersections
// more matrix functions _Check..
// delete getPolygonateMesh
// analyze volume and surface area
//
// maybe add notice
// viewer new/delete/move for polygon poins
// engrave: makes it possible to raise the edges
// add skip3D option to copy
// later when getting points, transform 2D if any then transform 3D if any
// bug gridWidth=215.9 - 25.4 * (0.26 * 2) is different from 215.9 - 25.4 * 0.26 * 2
// check expand when there are horizontal facets
// delete a session
// memories, add text change to line number to optionSelect key in codec > var key = query.slice(0, 10)
// connect facets on point line in difference and union
// make circle, similar to arcFromTo, then make new O and Q
// multiply or mirror polygons, polylines and construction
// maybe join emboss with union
// mirror bend
// lathe
// spline?
// alphabetic encoding and compression
// spring or staple or hook or fastener
// parabola, parabolic interpolation
// triangulate non horizontal facets in differential inset or expansion
// delete getIntervalsIncludingEnd
// check view problem in donut
// bend __amplitudes=0,1 analysis=t basis2D=1,0 boundaryEquations=testBoundary center=2,2
// translationEquations=testTranslation work=donut {
// __rectangle points=-2 10
// string testBoundary=point[2] > 7.0 testTranslation=[point[0], 0.0, 0.0]
// }
// check polygonAnalysis when there are lone edges in brick around top wedge
// deprecate all non 3d tags in links
//
// check linkMap in getMeshAnalysis, count empty intersection pairs
// operate and transform polygons in wordscape, maybe use true location instead of inverse for points in drillMesh
// deprecate exclusiveIntersection
// better colors
// add nodes between exteriors to polygons, add node within new triangle
// triangulate coplanar for output, make basic shapes, combine loops from multiple meshes
// check for line intersection between polygons
// check for and join polylines in getXYPolygonsMap when there are missing faces
// check for intersection pairs between exteriors
// check for z at node level when converting to xy
// getDirectedPolygon3D using vertex z if available
// solids = [], solid = {meshes:[{name:, points:[], facets:[], matrix:4x4}], construction:"..", name, color, material}
// construction -> + union, - difference, * intersection
// rename xyz to 3D in pixel and voxel
// getTriangularMesh, getPolyhedralMesh, getCarving, getStatement, get JSON
// shape isLatticed, isPillar, mesh or pillar
// else statement could check for previousStatement then set all the previousStatement of the siblings
//
// other projects
// draw mammoth or mastodon


function drawLines(lines, pointMap) {
	for (var line of lines) {
		drawXYZPolyline([pointMap.get(line.beginKey), pointMap.get(line.endKey)], gPlanarColors[line.crossDirectionIndex])
//	document.writeln('<line x1="' + x1 + '" y1="' + y1 + '" x2="' + x2 + '" y2="' + y2 + '"  style="fill:none;stroke:' + line.color + ';" />')
//	document.writeln('<line x1="' + x1 + '" y1="' + y1 + '" x2="' + x2 + '" y2="' + y2 + '"  style="fill:none;stroke:' + line.color + ';" marker-end="url(#arrowhead)" />')
	}
}

function drawMesh(mesh) {
	var index = 0
	var points = mesh.points
//	var z = 0.0
	for (var facet of mesh.facets) {
		var polygon = new Array(facet.length)
		for (var keyIndex = 0; keyIndex < polygon.length; keyIndex++) {
			polygon[keyIndex] = points[facet[keyIndex]].slice(0)
			polygon[keyIndex] = getAddition3D(polygon[keyIndex], [0.06 * (index % 3), 0.04 * (index % 5), 0.028 * (index % 7)])
//			z = polygon[keyIndex][2]
		}
//		if (!isNaN(z)) {
//			index = Math.round(z)
//		}
		index++
		drawXYZPolygon(polygon, getRGBByIndex(index))
	}
}

function drawPixelMap(pixelMap) {
	for (var entry of pixelMap) {
		var key = entry[0]
		var value = entry[1]
		var parameters = key.split(',')
		var cx = parseFloat(parameters[0])
		var cy = parseFloat(parameters[1])
		document.writeln('<circle cx="' + cx + '" cy="' + cy + '" r="0.15" />')
		for (directionIndex = 0; directionIndex < gXYDirections.length; directionIndex++) {
			var xy = value[directionIndex]
			if (xy != null) {
				var direction = gXYDirections[directionIndex]
				document.writeln('<circle cx="' + xy[0] + '" cy="' + xy[1] + '" r="0.04" />')
				var cxTip = cx + 0.15 * direction[0]
				var cyTip = cy + 0.15 * direction[1]
				document.writeln('<circle cx="' + cxTip + '" cy="' + cyTip + '" r="0.02" />')
			}
		}
	}
}

function drawVoxelMap(voxelMap) {
	for (var entry of voxelMap) {
		var value = entry[1]
		var parameters = entry[0].split(',').slice(0).map(parseFloat)
		var center = getXYPointStringByXYZ(parameters).split(',')
		var rgbString = '" style="stroke:rgb(' + getRGBByIndex(Math.round(parameters[2])).join(',') + ')" />'
		document.writeln('<circle cx="' + center[0] + '" cy="' + center[1] + '" r="0.3' + rgbString)
		for (directionIndex = 0; directionIndex < gDirections.length; directionIndex++) {
			xyz = value[directionIndex]
			if (xyz != null) {
				direction = gDirections[directionIndex]
				var cTip = getXYPointStringByXYZ(xyz).split(',')
				document.writeln('<circle cx="' + cTip[0] + '" cy="' + cTip[1] + '" r="0.08' + rgbString)
				var cDirection = getXYPointStringByXYZ(add3D(getMultiplication3DScalar(direction, 0.3), parameters)).split(',')
				document.writeln('<circle cx="' + cDirection[0] + '" cy="' + cDirection[1] + '" r="0.04' + rgbString)
			}
		}
	}
}

function drawXYInsetPolygon(xyPolygon, inset) {
	inset = getValueByDefault(0.2, inset)
	drawXYPolygon(getOutsetPolygon([inset, inset], getArraysCopy(xyPolygon)), getRGB())
}

function drawXYInsetPolygons(xyPolygons, inset) {
	for (var xyPolygon of xyPolygons) {
		drawXYInsetPolygon(xyPolygon, inset)
	}
}

function drawXYLines(lines, pointMap) {
	for (var line of lines) {
		var pointStrings = [pointMap.get(line.beginKey).join(','), pointMap.get(line.endKey).join(',')]
		document.writeln('<polyline points="' + pointStrings.join(' ') + '" style="stroke:rgb(' + gPlanarColors[0].join(',') + ')" />')
	}
}

function drawXYPolygon(xyPolygon, rgb) {
	rgb = getValueByDefault(getRGB(), rgb)
	var pointStrings = new Array(xyPolygon.length)
	for (var pointIndex = 0; pointIndex < xyPolygon.length; pointIndex++) {
		if (xyPolygon[pointIndex].length < 3) {
			pointStrings[pointIndex] = xyPolygon[pointIndex].join(',')
		}
		else {
			pointStrings[pointIndex] = xyPolygon[pointIndex].slice(0, 2).join(',')
		}
	}
	var polygonString = '<polygon points="' + pointStrings.join(' ') + '" style="stroke:rgb(' + rgb.join(',') + ')"'
	polygonString += 'marker-mid="url(#arrowhead)" />'
	document.writeln(polygonString)
}

function drawXYPolygons(xyPolygons, increments) {
	var addition = [0, 0]
	var increments = getValueByDefault([[0.0, 0.0]], increments)
	for (var polygonIndex = 0; polygonIndex < xyPolygons.length; polygonIndex++) {
		var xyPolygon = xyPolygons[polygonIndex]
		var xyPolygonCopy = getArraysCopy(xyPolygon)
		add2Ds(xyPolygonCopy, addition)
		drawXYPolygon(xyPolygonCopy, getRGB())
		add2D(addition, increments[polygonIndex % increments.length])
	}
}

function drawXYPolyline(xyPolyline, rgb) {
	var pointStrings = new Array(xyPolyline.length)
	for (var pointIndex = 0; pointIndex < xyPolyline.length; pointIndex++) {
		if (xyPolyline[pointIndex].length < 3) {
			pointStrings[pointIndex] = xyPolyline[pointIndex].join(',')
		}
		else {
			pointStrings[pointIndex] = xyPolyline[pointIndex].slice(0, 2).join(',')
		}
	}
	document.writeln('<polyline  points="' + pointStrings.join(' ') + '" style="stroke:rgb(' + rgb.join(',') + ')" />')
}

function drawXYPolylines(xyPolylines) {
	for (var xyPolyline of xyPolylines) {
		drawXYPolyline(xyPolyline, getRGB())
	}
}

function drawXYZPoints(points) {
	for (var point of points) {
		var center = getXYPointStringByXYZ(point).split(',')
		document.writeln('<circle cx="' + center[0] + '" cy="' + center[1] + '" r="0.02" />')
	}
}

function drawXYZPolygon(points, rgb) {
	document.writeln('<polygon  points="' + getXYPointStringsByXYZ(points).join(' ') + '" style="stroke:rgb(' + rgb.join(',') + ')" />')
}

function drawXYZPolygons(xyzPolygons) {
	for (var xyzPolygon of xyzPolygons) {
		drawXYZPolygon(xyzPolygon, getRGB())
	}
}

function drawXYZPolyline(points, rgb) {
	document.writeln('<polyline  points="' + getXYPointStringsByXYZ(points).join(' ') + '" style="stroke:rgb(' + rgb.join(',') + ')" />')
}

function getSVGTextLength(character) {
	document.writeln('<text x=20 y="5" fill="blue" id="' + character + '">' + character + '</text>')
	return document.getElementById(character).getComputedTextLength()
}

function getXYPointStringByXYZ(point) {
//	return [point[0], point[1] + point[2] * 0.3].join(',')
	var point2D = [point[0] + point[2] * 0.3, point[1] + point[2] * 0.2]
	if (Number.isNaN(point2D[0])) {
		point2D[0] = 0.0
	}
	if (Number.isNaN(point2D[1])) {
		point2D[1] = 0.0
	}
	return point2D.join(',')
}

function getXYPointStringsByXYZ(points) {
	var pointStrings = new Array(points.length)
	for (var pointIndex = 0; pointIndex < points.length; pointIndex++) {
		pointStrings[pointIndex] = getXYPointStringByXYZ(points[pointIndex])
	}
	return pointStrings
}

function testBend() {
	console.log('testBend')
	var amplitudes = [[0,1,1], [2,3,3]]
	console.log('additionInterpolation')
	console.log(additionInterpolation(0.5, amplitudes, 2))
	console.log(zoomInterpolation(0.5, amplitudes, [undefined, undefined, 5.0], undefined, 3))
//	var pointString = '-2,-2 -2,9 12,-2 0,-1 0,7 10,-1 1,0 1,5 6,0 2,1 4,1 2,3 11,1 13,1 11,3'
	var pointString = '-2,-2,0 -2,6,0 5,-2,0'
//	var pointString = '-2,-2 -2,6 5,-2 4,-2 3,-2 2,-2 1.5,-2 1,-2 0,-2 -1,-2'
	var points = getPointsByString(pointString)
//	noticeByList([points])
	drawXYPolygon(points, getRGB())
	var boundaryEquation = 'point[0] > 0.0'
	var boundaryPolygons = [[[-3,-3], [-3,2], [8,-3]]]
	var translationEquation = '3.0'
	var variableMap = new Map()
	var parent = {parent:undefined, variableMap:variableMap}
	var statement = {parent:parent}
	drawXYPolygons(boundaryPolygons)
	var stratas = [[-5,-3]]
	var amplitudes = [[0.0, 0.0], [1.0, 1.0], [2.0, 2.0], [3.0, 3.0], [4.0, 4.0], [5.0, 5.0, -3.0]]
	var boundedPoints = points
//	var pointIndexSet = new Set()
//	var boundedPoints = getBoundedPointsBySet(pointIndexSet, points)
//	var boundedPoints = getBoundedPoints2D([boundaryEquation], points, boundaryPolygons, null, statement)
//	var boundedPoints = getBoundedPoints2D(null, points, [[[-3,-3], [-3,2], [2,-3]]])
	console.log('boundedPoints')
	console.log(getArraysCopy(boundedPoints))
	console.log(getArraysCopy(points))
	console.log(boundaryPolygons)
//	transformPoints2DByEquation(amplitudes, null, boundedPoints, null, statement, null, null)
	transformPoints2DByEquation(amplitudes, [0.0, -5.0], boundedPoints, null, statement, null, [0.0, 1.0])
//	transformPoints3DByEquation(amplitudes, null, boundedPoints, null, statement, [translationEquation], null)
	console.log(boundedPoints)
	drawXYPolygon(points, getRGB())
	console.log(points)
}

function testBevel() {
	console.log('testBevel')
	var bevels = [[0.0, 0.3], [1.2, 0.2]]
	var boundaryEquations = null
	var mesh = getPillarMesh([0.0, 6.0], getUnitMatrix3D(), [[[0,-1,0], [0,4,0], [2,5,0], [3,4,0], [4,-1,0], [2,-3,0]]])
//	drawMesh(mesh)
	var polygons = [[[-1,1], [-1,-5], [9,-5], [9,1]]]
	var splitBevels = [[2.5, 0.4]]
	splitMeshByBevels(boundaryEquations, 'testBevel', null, mesh, polygons, null, splitBevels, null)
	var pointIndexSet = getPointIndexSet(boundaryEquations, [], mesh.points, polygons, mesh, null, [], null, [[-1,1]])
	console.log(pointIndexSet)
	console.log(mesh)
	bevelPoints(bevels, null, mesh, pointIndexSet, mesh.points, splitBevels)
	drawMesh(mesh)
}

function testConnectedFacet() {
	console.log('testConnectedFacet')
//	var pointString = '0,0 2,8 4,3 4,0 2,2 2,3 3,3 3,2 2.8,3.2 2.8,3.4 3,3.4 3,3.2'
	var pointString = '0,0 0,5 12,5 12,0 7,1 7,2 8,2 8,1 10,2 11,2 11,1'
	var points = getPointsByString(pointString)
	var facets = [[0, 1, 2, 3], [7, 6, 5, 4]]
//	var facets = [[0, 1, 2, 3], [7, 6, 5, 4], [10, 9, 8]]
	var connectedFacet = getConnectedFacet(facets, points)
	facets = [connectedFacet, [10, 9, 8]]
	connectedFacet = getConnectedFacet(facets, points)
	var connectedPolygon = getPolygonByFacet(connectedFacet, points)
	console.log(connectedFacet)
	console.log(connectedPolygon)
	drawXYPolygon(connectedPolygon)
}

function testDrillByMesh() {
	var pointString = '-2,-2,0 -2,7,0 7,8,0 12,-2,0 10,-1,2 0,7,2 0,-1,2 14,1,6 16,1,6 14,3,6'
//	var pointString = '-2,-2,0 -2,7,0 7,8,0 12,-2,0 0,-1,2 0,7,2 10,-1,2 1,-1,5 1,5,5 7,-1,5 14,1,6 16,1,6 14,3,6'
	var facets = [[0, 1, 2, 3], [4, 5, 6], [7, 8, 9]]
	var points = getPointsByString(pointString)
	var centerPolygon = [[4, 1], [6, 1], [5, 3]]
	var centerMesh = getPillarMesh([0.0, 1.0], getUnitMatrix3D(), [centerPolygon])
//	drawMesh(centerMesh)
//	drawXYPolygon(centerPolygon, getRGB())
	drillByMesh(centerMesh, null, getUnitMatrix3D(), {facets:facets, points:points})
	drawXYZPolygons(getPolygonsByFacets(facets, points))
}

function testEquation() {
	console.log('testEquation')
//	var valueString = ' 5 * ( 1 + 1 ) * 3 * ( 2 + 2 ) '
//	var valueString = ' ( 3 % 2 ) * .3 * Math.min(8,11) + stringLength( testString ) '
//	var valueString = ' 25 + 10 * 1.5 '
//	var valueString = ' -Math.min(8,11) -Math.min(8,11) -Math.min(8,11) '
//	var valueString = ' min(8,1.5*max(3,4)) '
	var valueString = 'intervalsFromToIncrement(0,3.5,1)[0]'
//	var valueString = ' -2+1 '
//	var valueString = ' true && false '
//	var valueString = ' 4, '
//	var valueString = ' 1+2*3+4 '
//	var valueString = ' stringLength( testString ) '
//	var valueString = ' ( 5 % 3 ) + stringLength( testString ) '
//	var valueString = ' intervalsFromToIncrement(0,3.5,1) '
//	var valueString = ' testMap.value '
//	var valueString = ' Math.sin(1) '
//	var valueString = ' testArray[0][0] '
//	var valueString = ',2'
//	var valueString = ' 1,2 '
//	var valueString = ' [[3,5,7]] '
//	var valueString = ' [[3,5], [7,9] ] '
//	var valueString = ' [[3,5,7],[4,6,8]][0][1] '
//	var valueString = ' [5*[2][0]] '
//	var valueString = ' -2e5 '
//	var valueString = 'zigzag(1,8)'
//	var valueString = 'zigzag([2,3])'
//	var valueString = 'zigzag([4,5],9)'
//	var valueString = 'zigzag([[0,0], [1,3],[2,0],[3,4]], 0.17)'
//	var valueString = 'zigzag([[[1,2],3,4],5])'
	var mathMap = new Map([['min', Math.min], ['sin', Math.sin]])
	var testMap = new Map([['value', '3']])
	stringLength.optionSet = gSetS
	zigzag.optionSet = null
	var variableMap = new Map([
		['intervalsFromToIncrement', intervalsFromToIncrement],
		['max', Math.max],
		['min', Math.min],
		['stringLength', stringLength],
		['Math', mathMap],
		['test', '2'],
		['testArray', '[[3,4],[5,6]]'],
		['testMap', testMap],
		['zigzag', zigzag]])
	var parent = {parent:undefined, variableMap:variableMap}
	var statement = {parent:parent}
	var value = getValueByEquation(null, statement, valueString)
	console.log('value')
	console.log(value)
//	console.log(parseFloat(valueString))
}

function testExpand() {
	console.log('testExpand')
	var pointString = '0,-4,0 0,5,0 4,0,0 9,-4,0'
	var polygon3D = getPointsByString(pointString)
	var heights = [0.0, 1.0]
//	var heights = [0.0, 0.5, 1.0]
	var pillarMesh = getPillarMesh(heights, null, [polygon3D])
	drawMesh(pillarMesh)
	console.log('pillarMesh points')
	console.log(pillarMesh.points)
	console.log(pillarMesh.facets)
	var expansionXY = [1.6]
	expandMesh(0.0, expansionXY, 1.0, getUnitMatrix3D(), pillarMesh)
//	drawMesh(pillarMesh)
//	taperMesh(getUnitMatrix3D(), 2.0, 40.0, 15.5, pillarMesh)
	drawMesh(pillarMesh)
}

function testExtrusion() {
	console.log('testExtrusion')
//	var value = 'g transforms=rotate3D(0,0,1,index*5) heights=0,1,2'
//	var value = 'g transforms=rotate(index*9) heights=0,1,2'
//	var value = 'g transforms=stair(0,-1,(2+1) 2,-3,4 4,-5,6)'
//	var value = 'g transforms=path(0,-1,3 2,-3,4 4,-5,6)'
//	var value = 'g transforms=path(0,-1,3 2,-3,4)'
	var value = 'rotateZ(30) translate(1,2,3) path(0,0,0 0,-.5,3 0,0,6)'
//	var value = 'g transforms=path(0,0,0 0,-.5,3 0,0,6)'
	var parent = getStatementByParentTag(new Map(), 1, undefined, 'g')
	var registry = {dataMap:new Map(), idMap:new Map(), meshMap:new Map()}
	var statement = getStatementByParentTag(new Map([['transforms', value]]), 1, parent, 'g')
	console.log(statement)
	console.log(getBracketSeparatedWords(statement.attributeMap.get('transforms')))
	var matrices = getMatrices3DAndZeroHeight(registry, statement, null)
	var polygons = [[[0, 0], [0, 5], [10, 0]]]
	console.log('matrices')
	console.log(matrices)
	console.log(statement)
	var extrusionMesh = getExtrusionMesh(false, matrices, getUnitMatrix3D(), polygons)
	console.log(extrusionMesh)
	drawMesh(extrusionMesh)
//	console.log(get3DMatrix(registry, statement))
}

function testFace() {
	var lines = []
	var pointMap = new Map()
	var tipMap = new Map()
//	var pointString = '0,-1,0 450,-1,0 0,-1,200 0,200,0'
	var pointString = '0,-1,0 9,-1,0 0,-1,4 0,4,0'
	points = getPointsByString(pointString)
	var mesh = {facets:[[0, 1, 2], [0, 2, 3], [1, 3, 2], [0, 3, 1]], points:points}
	var lattice = getXYZLatticeByMesh(mesh)
	var voxelMap = getVoxelMapByXYZLattice(lattice)
//	drawVoxelMap(voxelMap)
	addVoxelLines(2, voxelMap, lines, pointMap, tipMap)
	addVoxelLines(0, voxelMap, lines, pointMap, tipMap)
	addVoxelLines(1, voxelMap, lines, pointMap, tipMap)
//	drawLines(lines, pointMap)
//	drawMesh(getMeshByTipMap(pointMap, tipMap))
	mesh = getPolygonateMesh(getMeshByTipMap(pointMap, tipMap))
	add2Ds(mesh.points, [7, -6])
	drawMesh(mesh)
	drawXYZPoints(mesh.points)


//	var xyzPolygons = getPolygonsByLines(lines, pointMap)
//	drawXYZPolygons(xyzPolygons)
//	var lines = []
//	var pointMap = new Map()
//	var tipMap = new Map()
//	rotateXYZParametersByPoints(2, mesh.points)
//	var xyPolygonsMap = getSlicePolygonsMapByMesh(mesh)
//	var voxelMap = getVoxelsByXYPolygonsMap(xyPolygonsMap)
//	addVoxelLines(2, voxelMap, lines, pointMap, tipMap)
//	var xyzPolygons = getPolygonsByLines(lines, pointMap)
//	rotateXYZParametersByPointLists(-2, xyzPolygons)
//	drawXYZPolygons(xyzPolygons)
}

function testFacetSubtraction() {
	console.log('testFacetSubtraction')
//	in future facet normal hint for intersections - acceptance angle
	var lowerToolPolygon = getPointsByString('4,0 4,2 0,2 0,0')
	var workMesh = getPillarMesh([0,5], null, [getPointsByString('0,3 4,3 4,0 0,0')])
//	var workMesh = getPillarMesh([0,4], null, [getPointsByString('0,0 0,5 10,5 10,0')])
//	workMesh.facets = [workMesh.facets[0]]
	console.log('workMesh.facets')
	console.log(workMesh.facets.slice(0))
	differenceByPolygon('lowerToolPolygon', [], [], null, lowerToolPolygon, workMesh)
	console.log('workMesh.facets')
	console.log(workMesh.facets)
	console.log('workMesh.points')
	console.log(workMesh.points)
	drawMesh(workMesh)
	console.log(workMesh)
	console.log(workMesh.points.length)
//	console.log(getIsFacetPointingOutside(workMesh))
	console.log(getMeshAnalysis(getTriangleMesh(workMesh)))
//	console.log(getMeshAnalysis(workMesh))
}

function testFence() {
	console.log('testFence')
	var betweens = [0.25, 0.5, 0.75]
	var bottoms = [0.0, -1.0]
	var curve = '(z - 0.5) * (z - 0.5)'
	var heights = [0, .1, .2]
	var overhangAngle = 45 * gRadiansPerDegree
	var statement = {parent:{parent:undefined, variableMap:new Map()}}
	var thickness = 0.06
	var tops = [[0, 0, 1], [3, 1, 2], [6, 4, 5]]
	var width = 0.48
	var mesh = getFenceMesh(betweens, bottoms, curve, heights, overhangAngle, null, statement, thickness, tops, width)
	console.log('mesh points')
	console.log(mesh.points)
	console.log(mesh.facets)
	drawMesh(mesh)
}

function testFillet() {
	console.log('testFillet')
//	var polygon = getPointsByString('0,-2 0,4 4,4 4,2 2,2 2,0 4,0 4,-2')
//	var polygon = getPointsByString('0,0 0,4 4,4 4,3 2,3 2,0')
	var polygon = getPointsByString('0,0 0,4 2.5,4 4,4 4,3 2,3 2,0')
//	var polygon = getPointsByString('0,0 0,20 20,0 5,0')
	var radius = 5.0
	drawXYPolygon(polygon, getRGB())
//	var filletedPolygon = getFilletedPolygon(9, polygon, radius)
	var filletedPolygon = getFilletedPolygon(36, polygon, radius)
	console.log('filletedPolygon')
	console.log(filletedPolygon)
	drawXYPolygon(filletedPolygon, getRGB())
}

function testFormattedText() {
	console.log('testFormattedText')
	var attributeMap = new Map()
	var format = {fontSize:12, name:'yo', xOffset:0}
	var registry = {dataMap:new Map(), generatedIDSet:new Set(), idMap:new Map(), meshMap:new Map(), views:[]}
	var text = 'hello dave #p wide light bigbigbigword what is a matter with the clothes I am wearing can #/'
	var parent = getStatementByParentTag(new Map(), 1, undefined, 'g')
	var statement = getStatementByParentTag(attributeMap, 1, parent, 'formattedText')
	var attributeMap = new Map([['font-size', '3'], ['left', '5'], ['right', '20'], ['text-anchor', 'start'], ['x', '0'], ['y', '10']])
	var root = {attributeMap:attributeMap}
	var format = {attributeMap:new Map([['name', 'DaveTest']]), parent:root}
	addTextStatements(format, registry, statement, text)
	console.log('root')
	console.log(root)
	console.log(statement)
}

function testIntercircle() {
	console.log('testIntercircle')
//	var points = getPointsByString('0,0 0,2 2,2 2,0')
//	var points = getPointsByString('0,0 0,3 3,3 0,3 0,6 6,6 6,0 0,0')
	var points = getPointsByString('3.25,1.5 3.25,0 0,0 0,5.25')
//	var points = getPointsByString('0,0 2,0 2,2')
//	var points = getPointsByString('0,0 2,0 1,1.7')
//	var points = getPointsByString('0,0 2,0 4,0')
//	console.log('points')
//	console.log(points)
	var intercircleLoops = getIntercircleLoopsByPolylines([points], 1.1)
//	var intercircleLoops = [getPointsByString('0,0 7,0.0 8,4 8,0')]
//	var intercircleLoops = [getPointsByString('0,0 2,0 2,2 2,0')]
	for (var intercircleLoop of intercircleLoops) {
		console.log(intercircleLoop)
//		drawXYPolygon(intercircleLoop, getRGB())
		var insetPolygon =
		getOutsetPolygonByMarker(null, null, true, [0.2, 0.2], intercircleLoop, [[-1.2, 0], [0, 1.2], [1.2, 0]], [0.2, 0.2])
		console.log(insetPolygon)
		drawXYPolygon(insetPolygon, getRGB())
	}
//		drawXYPolyline(points, getRGB())
}

function testJoin() {
	console.log('testJoin')
//	var leftString = '0,-4,0 0,5,0 9,-4,0'
	var leftString = '-2,-4,0 -2,5,0 2,5,0 2,-4,0'
	var heights = [0.0, 4.0]
	var leftMesh = getPillarMesh(heights, null, [getPointsByString(leftString)])
//	drawMesh(leftMesh)
	var rightString = '4,-4,0 4,5,0 9,5,0 9,-4,0'
	var rightMesh = getPillarMesh(heights, null, [getPointsByString(rightString)])
//	drawMesh(rightMesh)
	console.log('leftMesh points')
	console.log(leftMesh.points)
	console.log(leftMesh.facets)
	joinMeshes([getMatrix3DByTranslate([0,0,10])], null, [leftMesh, leftMesh])
//	joinMeshes([getMatrix2DByTranslate([0,7])], null, [leftMesh, rightMesh])
	leftMesh.facets = getAllTriangleFacets(leftMesh)
	drawMesh(leftMesh)
}

function testLength() {
	console.log('testLength')
	var numberLength = {numberOfCharacters:0, totalGroupLength:0.0, totalLength:0.0}

//	font-size=1000 to get integers
	writeLengths('abcdefghi'.split(''), numberLength)
	writeLengths('jklmnopqr'.split(''), numberLength)
	writeLengths('stuvwxyz'.split(''), numberLength)
	writeLengths('ABCDEFGHI'.split(''), numberLength)
	writeLengths('JKLMNOPQR'.split(''), numberLength)
	writeLengths('STUVWXYZ'.split(''), numberLength)
	writeLengths('0123456789'.split(''), numberLength)
	writeLengths(')!@#$%^&*('.split(''), numberLength)
	writeLengths(',<.>/?;:['.split(''), numberLength)
	writeLengths('{]}\|-_=+`~'.split(''), numberLength)

	console.log(numberLength)
	console.log(numberLength.totalLength / numberLength.numberOfCharacters)
	console.log(numberLength.totalLength / numberLength.totalGroupLength)
}

function testLettering() {
	console.log('testLettering')
	console.log('ABCDEFGHIJKLMNOPQRSTUVWXYZ')
//	console.log('arcFromToCenter()')
//	var arc = arcFromToCenter(0, 1, 0, -2, 5)
//	console.log(arc)
//	drawXYPolygon(arc, getRGB())
//	var branchA = getPointsByString('0,0 0.2,0.8 0.5,2 0.8,0.8 1,0')
//	var branchB = getPointsByString('0.2,0.8 0.8,0.8')
//	var branches = [branchA, branchB]
//	var polylines = getCharacterPolylines('A')
//	if (polylines != null) {
//		drawXYPolylines(polylines)
//	}
	var letteringOutlines = getLetteringOutlines(1.2, 0.15, ' ABCDEF GHIJKLMNOPQRSTUVWXYZ ', 0.2)
	drawXYPolygons(letteringOutlines)
}

function testLinkMap() {
	console.log('testLinkMap')
	var linkMap = new Map()
	addToLinkMap(0, 1, linkMap)
	addToLinkMap(1, 2, linkMap)
	addToLinkMap(2, 3, linkMap)
	addToLinkMap(3, 1, linkMap)
	addToLinkMap(4, 5, linkMap)
	addToLinkMap(5, 2, linkMap)
	addToLinkMap(6, 5, linkMap)
	console.log(linkMap)
	var joinedMap = getJoinedMap(7, linkMap)
	console.log(joinedMap)
}

/*
function testLoop() {
	var lines = []
	var pointMap = new Map()
	var tipMap = new Map()
	var xyPolygonsMap = new Map()
	xyPolygonsMap.set(0, [[[3,-4], [9,-1], [10,-4]]])
	xyPolygonsMap.set(1, [[[3,-4], [9,-1], [10,-4]]])
	var voxelMap = getVoxelsByXYPolygonsMap(xyPolygonsMap)
	drawVoxelMap(voxelMap)
	addVoxelLines(2, voxelMap, lines, pointMap, tipMap)
//	addVoxelLines(0, voxelMap, lines, pointMap, tipMap)
//	addVoxelLines(1, voxelMap, lines, pointMap, tipMap)
	var xyzPolygons = getPolygonsByLines(lines, pointMap)
	drawXYZPolygons(xyzPolygons)
//	drawLines(lines, pointMap)
}
*/

function testMeshBoolean() {
	var pointString = '0,0,0 5,0,0 0,0,4 0,4,0'
	var pointsA = getPointsByString(pointString)
//	add2Ds(pointsA, [0.00001, 0.0])
//	addArraysByZ(pointsA, -0.01777)
	multiply2DsByScalar(pointsA, 2.0)
	var meshA = {facets:[[0, 1, 2], [0, 2, 3], [1, 3, 2], [0, 3, 1]], points:pointsA}
	var lattice = getXYZLatticeByMesh(meshA)
	var pointStringB = '0,-1,0 6,-1,0 0,-1,4 0,4,0'
	var pointsB = getPointsByString(pointStringB)
	add2Ds(pointsB, [1, 0.0])
//	addArraysByZ(pointsB, -0.000000000000001)
	multiply2DsByScalar(pointsB, 2.0)
	var meshB = {facets:[[0, 1, 2], [0, 2, 3], [1, 3, 2], [0, 3, 1]], points:pointsB}
	var offsetMultiplier = 0.0
//	var offsetMultiplier = 0.49
//	var layerThickness = 0.100000
	var layerThickness = 0.49999999999999999
	var meshBoolean = null
//	meshBoolean = getMeshAddition(layerThickness, offsetMultiplier, meshA, meshB)
	meshBoolean = getMeshExclusiveIntersection(layerThickness, offsetMultiplier, meshA, meshB)
//	meshBoolean = getMeshIntersection(layerThickness, offsetMultiplier, meshA, meshB)
//	meshBoolean = getMeshSubtraction(layerThickness, offsetMultiplier, meshA, meshB)
	drawMesh(meshBoolean)
//	drawXYZPoints(meshBoolean.points)
	console.log(getMeshAnalysis(meshBoolean))
}

function testMirrorJoin() {
	console.log('testMirrorJoin')
	var leftString = '-2,-4,0 -2,5,0 2,5,0 2,-4,0'
	var heights = [0.0, 4.0]
	var leftMesh = getPillarMesh(heights, null, [getPointsByString(leftString)])
//	drawMesh(leftMesh)
	var mirroredMesh = getMeshCopy(leftMesh)
	mirrorMesh(getCenterDirectionByCenterDirection([3.0], null), null, mirroredMesh)
	console.log('leftMesh points')
	console.log(leftMesh.points)
	console.log(leftMesh.facets)
	joinMeshes(null, null, [leftMesh, mirroredMesh])
	leftMesh.facets = getAllTriangleFacets(leftMesh)
	drawMesh(leftMesh)
}

function testOutline() {
	console.log('testOutline')	
	var branchAString = '0,0 0,2 0,4'
	var branchA = getPointsByString('0,0 0,2 0,4')
	var branchB = getPointsByString('0,2 2,2 4,4')
	var branches = [branchA, branchB]
	drawXYPolylines(branches)
//	return
//	var points = getPointsByString('0,0 0,2 2,2 2,0')
//	var points = getPointsByString('0,0 0,3 3,3 0,3 0,6 6,6 6,0 0,0')
//	var points = getPointsByString('-4,2 0,0 0,6 6,6 6,0 0,0 -4,2')
//	var points = getPointsByString('3.25,1.5 3.25,0 0,0 0,5.25')
//	var points = getPointsByString('0,0 2,0 2,2')
//	var points = getPointsByString('0,0 2,0 1,1.7')
//	var points = getPointsByString('0,0 2,0 4,0')
//	var points = getPointsByString('0,0 0,4 0,2 2,2 4,4 2,2 0,2')
//	var points = getPointsByString('0,0 0,2 2,2 4,4 2,2 0,2 0,4')
//	console.log('points')
//	console.log(points)
//		drawXYPolygon(points, getRGB())
	var outlines = getOutlinesQuickly([0.0, 0.0], [[0, 1.2]], true, [[1, 1], [0.5, 0.5]], branches, [[-1.2, 0], [0, 1.2], [1.2, 0]])
		console.log(outlines)
	drawXYPolygons(outlines)
	for (var outline of outlines) {
		console.log(outline)
		drawXYPolygon(outline, getRGB())
	}
//	var polygon = [[0,0], [1,0], [2,1], [1,0]]
//	var baseIndex = 0
//	drawXYPolygon(polygon, getRGB())
//	console.log('stringAlongMap')
//	var stringAlongMap = getStringAlongMap(baseIndex, polygon)
//	console.log(stringAlongMap)
}

function testOutset() {
	console.log('testOutset')
//	var pointString = '0,0 0,4 6,4 6,0'
	var pointString = '0,0 0,4'
//	var pointString = '0,0 0,2 6,4 6,0'
//	var pointString = '6,0 6,4 0,2 0,0'
//	var pointString = '8,-2 3,1 0,6 0,-2'
//	var pointString = '0,0 40,0 40,20 20,2 0,20'
	var xyPolygon = getPointsByString(pointString)
	drawXYPolygon(xyPolygon, getRGB())

	var outsetPolygon = getOutsetPolygonByMarker(null, null, false, [[1.0, 1.0]], xyPolygon, null)
//	var outsetPolygon = getOutsetPolygon([1.0, 1.0], xyPolygon)
	console.log('outsetPolygon')
	console.log(outsetPolygon)
	drawXYPolygon(outsetPolygon, getRGB())
}

function testOverlap() {
	console.log('testOverlap')
	var polygons = [getPointsByString('0,0 0,2 10,2 10,0')]
	polygons.push(getPointsByString('4,-4 4,6 6,6 6,-4'))
	polygons.push(getPointsByString('0,4 0,5 8,5 8,4'))
//	drawXYPolygons(polygons)
	var overlappedPolygons = getOverlappedPolygons([0.5, 0.5], polygons)
	console.log(overlappedPolygons)
	drawXYPolygons(overlappedPolygons)
}

function testPixelBoolean() {
	var lines = []
	var pixelMap = new Map()
	var pointMap = new Map()
	var tipMap = new Map()
	var xyPolygonA = [[0, 0], [0, 4], [4, 0]]
//	var xyPolygonA = [[0, -1], [0, 4], [6, -1]]
	add2Ds(xyPolygonA, [6, 0])
//	addTestPixels(pixelMap)
//	createPixelTips(pixelMap)
//	addPixelLines(pixelMap, lines, pointMap, tipMap)
//	var xyPolygons = getPolygonsByLines(lines, pointMap)
	var xyLattice = getXYLattice([xyPolygonA])
//	var xyLattice = getXYLattice(xyPolygons)
//	var xyPolygons = getXYPolygonsByLattice(xyLattice)
//	drawXYPolygon(xyPolygons[0], [255, 0, 0])
//	var pointStringB = '0,-1,0 6,-1,0 0,-1,4 0,4,0'
	var xyPolygonB = [[0, -1], [0, 4], [6, -1]]
	add2Ds(xyPolygonB, [10, 0])
//	var xyPolygonB = [[8.5,1.5], [8.5,3.5], [9.5,3.5], [9.5,1.5]]
	var xyLatticeB = getXYLattice([xyPolygonB])
//	console.log(xyLatticeB)
	var xyPolygonBFromLattice = getXYPolygonsByLattice(xyLatticeB)[0]
//	console.log(xyPolygonBFromLattice)
	xyLatticeC = getXYLatticeAddition(xyLattice, xyLatticeB)
//	xyLatticeC = getXYLatticeExclusiveIntersection(xyLattice, xyLatticeB)
//	xyLatticeC = getXYLatticeIntersection(xyLattice, xyLatticeB)
//	xyLatticeC = getXYLatticeSubtraction(xyLattice, xyLatticeB)
	drawPixelMap(getPixelMapByLattice(xyLatticeC[0]))
	var xyPolygonsCFromLattice = getXYPolygonsByLattice(xyLatticeC)
	drawXYPolygons(xyPolygonsCFromLattice)
//	var pointListTest = [[0, 1, 2]]
//	rotateXYZParametersByPoints(2, pointListTest)
}

function testPolygonate() {
	console.log('testPolygonate')
	var pointString = '0,-4,0 0,5,0 9,-4,0'
	var polygon3D = getPointsByString(pointString)
	var heights = [0.0, 4.0]
	var pillarMesh = getPillarMesh(heights, null, [polygon3D])
//	drawMesh(pillarMesh)
	console.log('pillarMesh points')
	console.log(pillarMesh.points)
	console.log(pillarMesh.facets)
	var trianglePillarMesh = getTriangleMesh(pillarMesh)
//	drawMesh(trianglePillarMesh)
	var joinedMesh = getPolygonateMesh(trianglePillarMesh)
	drawMesh(joinedMesh)
}

function testPolygonBoolean() {
	var xyPolygonA = [[0, 0], [4, 0], [0, 4]]
	multiply2DsByScalar(xyPolygonA, 2.0)
//	var xyPolygonA = [[0, 0], [0, 4], [4, 0]]
//	add2Ds(xyPolygonA, [6, 0])
	var xyPolygonB = [[0, -1], [0, 4], [6, -1]]
	add2Ds(xyPolygonB, [1, 0])
//	add2Ds(xyPolygonB, [9, 0])
	multiply2DsByScalar(xyPolygonB, 2.0)
//	drawXYPolygons([xyPolygonA])
//	drawXYPolygons([xyPolygonB])
	var layerThickness = 0.05
	var offsetMultiplier = 0.45
	var polygonsBoolean = null
	polygonsBoolean = getPolygonsAddition(layerThickness, offsetMultiplier, [xyPolygonA], [xyPolygonB])
//	polygonsBoolean = getPolygonsExclusiveIntersection(layerThickness, offsetMultiplier, [xyPolygonA], [xyPolygonB])
//	polygonsBoolean = getPolygonsIntersection(layerThickness, offsetMultiplier, [xyPolygonA], [xyPolygonB])
//	polygonsBoolean = getPolygonsSubtraction(layerThickness, offsetMultiplier, [xyPolygonA], [xyPolygonB])
	drawXYPolygons(polygonsBoolean)
}

function testPolygonGroups() {
	console.log('testPolygonGroups')
	var outside = getPointsByString('0,0 0,10 10,0')
	var inside = getPointsByString('1,1 1,8 8,1')
	var loner = getPointsByString('12,0 12,5 14,0')
	var loner = getPointsByString('12,0 12,5 14,3 14,0')
	var smaller = getPointsByString('2,2 2,6 6,2')
	var smallest = getPointsByString('3,3 3,4 4,3')
	var polygons = [outside, inside, loner, smaller, smallest]
	drawXYPolygons(polygons)
	var polygonGroups = getPolygonGroups(polygons)
	for (var polygonGroup of polygonGroups) {
		drawXYPolygon(getConnectedPolygon(polygonGroup), getRGB())
	}
}

function testPolygonJoining() {
//	polygonKeyStrings = ['0,0,0 1,1,0 1,0,0', '1,0,0 1,1,0 3,1,0']
//	polygonKeyStrings = ['-1,0,0 -1,2,0 0,2,0 1,1,0 2,2,0 3,2,0 3,0,0', '0,2,0 -1,2,0 -1,4,0 3,4,0 3,2,0 2,2,0 1,3,0']
//	polygonKeyStrings = ['-1,0,0 -1,2,0 0,2,0 1,1,0 2,2,0 3,2,0 4,2,0 5,2,0 6,2,0 4,0,0', '0,2,0 -1,2,0 -1,4,0 3,4,0 6,2,0 5,2,0 4,2,0 3,2,0 2,2,0 1,3,0']
//	polygonKeyStrings = ['0,0,0 -1,0,0 0,1,0', '0,0,0 0,1,0 1,0,0', '0,0,0 1,0,0 0,-1,0', '0,0,0 0,-1,0 -1,0,0']
//	polygonKeyStrings = ['0,-1,0 -1,0,0 0,0,0', '0,-1,0 0,0,0 1,0,0', '-1,0,0 0,1,1 1,0,0 0,0,0']
	var xyPolygonKeyStrings = ['-1,0 -1,2 0,2 1,1 2,2 3,2 4,1 5,2 6,2 6,0', '0,2 -1,2 -1,4 3,4 6,4 6,2 5,2 4,3 3,2 2,2 1,3']
	var xyFacets = getArraysBySplittingStrings(xyPolygonKeyStrings, ' ')
	drawXYPolygons(convertFacetsToPolygons(getArraysCopy(xyFacets)))
	var joinedFacets = getJoinedFacets(xyFacets)
	var joinedPolygons = convert2DPolygonsTo3D(convertFacetsToPolygons(joinedFacets), 0)
	var joinedMesh = getMeshByPolygons(joinedPolygons)
	var connectedFacet = getConnectedFacet(joinedMesh.facets, joinedMesh.points)
	drawMesh({facets:[connectedFacet], points:add2Ds(joinedMesh.points, [0, -6])})
}

function testRemoveTooThinFacets() {
	console.log('testRemoveTooThinFacets')
//	console.log(getIsXYZSegmentClose([0,0,0], [10,0,-5], [2,0,0]))
//	console.log(getIsXYZSegmentClose([0,0,0], [10,0,-5], [2,0,-1]))
//	console.log(getIsXYZSegmentClose([0,0,0], [10,0,-5], [0,0,0]))
	console.log(getIsXYZSegmentClose([2,0,0], [0,0,0], [1,0,0]))
//	var pointString = '0,0,0 0,0,0 0,1,0 1,0,0'
	var pointString = '0,0,0 1,0,0 2,0,0 3,2,0 3,0,0'
	var points = getPointsByString(pointString)
//	var facets = [[0, 1, 2, 3]]
	var facets = [[0, 1, 2, 3, 4, 2]]
	console.log('points')
	console.log(points)
	console.log(facets)
	var mesh = {facets:facets, points:points}
	drawMesh(mesh)
	removeTooThinFacets(mesh)
	console.log(facets)
	addArraysByY(mesh.points, -5)
	drawMesh(mesh)
}

function testRoad() {
	console.log('testRoad')
	var betweens = [0.5]
//	var betweens = [0.25, 0.5, 0.75]
	var centers = [[0,0,2], [2,0,4]]
//	var centers = [[0,0,2,50], [2,0,4], [4,2,8]]
	var curve = null
//	var curve = 'y * y'
	var heights = [0, 1]
//	var heights = [0, 1, 2]
	var numberOfIntervals = 4
	var statement = {parent:{parent:undefined, variableMap:new Map()}}
	var mesh = getPlankMesh(heights, centers.length - 1)
	convertPlankToRoad(betweens, centers, curve, null, mesh, null, statement)
	console.log('mesh points')
	console.log(mesh.points)
	console.log(mesh.facets)
	console.log(mesh)
	drawMesh(mesh)
}

function testSculptureVertical() {
	console.log('testSculptureVertical')
	var pointString = '7,-1 12,-8 7,-5 7,-8'
//	var pointString = '7,-1 12,-8 7,-5 7,-8'
	var points = getPointsByString(pointString)
	var gridMap = new Map()
	var gridMultiplier = getGridMultiplier(gridMap, points)
	var closestPoint = getClosestPoint(gridMap, gridMultiplier, [0.0, 0.0])
//	console.log('gridMultiplier')
//	console.log(gridMultiplier)
//	console.log(gridMap)
//	console.log(closestPoint)
	var layers = []
	var layersNew = []
	var matrix3D = getUnitMatrix3D()
	matrix3D[14] = 0.0
	var polygons = [[[0,0], [0,4], [2,4], [2,0]], [[4,0], [4,4], [6,4], [6,0]]]
//	var polygons = [[[0,0], [0,1], [0,3], [0,4], [2,4], [2,3], [2,1], [2,0]], [[4,0], [4,1], [4,3], [4,4], [6,4], [6,3], [6,1], [6,0]]]
	layersNew.push({matrix3D:matrix3D, polygons:polygons, vertical:true})
	matrix3D = getUnitMatrix3D()
	matrix3D[14] = 2.0
	layersNew.push({matrix3D:matrix3D, polygons:polygons, vertical:true})
	matrix3D = getUnitMatrix3D()
	matrix3D[14] = 4.0
//	layersNew.push({matrix3D:matrix3D, polygons:[[[0,0], [5,5], [10,5], [10,0]]], vertical:true})
//	layersNew.push({matrix3D:matrix3D, polygons:[[[0,0], [5,5], [7,5], [10,5]]], vertical:false})
//	layersNew.push({matrix3D:matrix3D, polygons:[[[0,0], [5,5], [10,4]]], vertical:false})
	layersNew.push({matrix3D:matrix3D, polygons:[[[0,0], [0,1], [2,1], [4,1], [6,1], [6,0], [4,0], [2,0]]], vertical:true})
//	layersNew.push({matrix3D:matrix3D, polygons:[[[0,0], [0,1], [6,1], [6,0]]], vertical:true})
	var meshNew = getSculptureMesh(layersNew, getUnitMatrix3D())
	console.log(layersNew)
	console.log(meshNew)
	drawMesh(meshNew)
}

function testSplitPoints() {
//	var pointString = '7,0,13 13,0,13 11,0,15 5,0,15'
//	var pointString = '11,0,4 8,0,4 8,0,14 11,0,14'
//	var points = getPointsByString(pointString)
//	points.reverse()
	var workMesh = getPillarMesh([0,10], null, [getPointsByString('0,0 0,5 10,5 10,0')])
//	differenceByPolygon('triangle', [], [], null, getPointsByString('8,-1 12,-1 12,2'), workMesh)
	differenceByPolygon('triangle', [], [], null, getPointsByString('8,-1 12,-1 12,2 8,2'), workMesh)
	addSplitIndexes('testSplitPoints', [3], workMesh)
//	drawXYPolygon(splitPoints, getRGB())
	console.log('splits')
	console.log(workMesh)
//	console.log(outerFacet)
//	console.log(closeFacet)
	drawMesh(workMesh)
}

function testSplitPolygon() {
	console.log('testSplitPolygon')
//	var pointString = '-4,0 -4,4 4,4 4,0'
//	var pointString = '5,0 5,3 7,3 7,0'
//	var polygon = getPointsByString(pointString)
//	drawXYPolygon(polygon, getRGB())
//	var leftPolygon = getPointsByString('-4,0 -4,4 4,4 4,0')
//	var leftPolygon = getPointsByString('-4,-4 -4,4 -2,4 -2,0 0,0 0,4 2,4 2,-4')
//	var leftPolygon = getPointsByString('-4,4 -4,-4 -2,-4 -2,2 0,2 0,-4 2,-4 2,4')
	var leftPolygon = getPointsByString('-4,-4 -4,4 -2,4 -2,0 -2,4 4,4 4,-4')
//	var leftPolygon = getPointsByString('167.39472524555626,13 173.61892976049137,13 171.90899735315065,15 165.68479283821554,15')
//	var leftPolygon = getPointsByString('7,0 13,0 11,5 5,5')
//	leftPolygon.reverse()
	var rightPolygon = getPointsByString('5,3 5,6 7,6 7,3')
	var polygons = []
//	var polygons = [leftPolygon, rightPolygon]
//	var polygons = [polygon]
	addSplitPolygonByHeight(leftPolygon, 1, polygons)
	console.log(polygons)
	drawXYPolygons(polygons)
}


function testSubtraction() {
	console.log('testSubtraction')
	//tested by getSubtractionLoops, used by getSubtractionFaces
//	meeting = {isToolNode, isWorkNode, toolAlong, workAlong}
//	added to meetings at meetingIndex as point from workAlong
//	added to toolMeetingsMap as toolIndex, [toolAlong, meetingIndex]
//	added to workMeetingsMap as workIndex, [workAlong, meetingIndex]
//	sorted by along in both maps
//	polygons divided into {beginIndex, beginPoints, endIndex, endPoints} set in toolSegmentMap and workSegmentMap
//	polygons divided into {beginIndex, beginPoints, endIndex, endPoints} set in toolSegmentMap and workSegmentMap
//	start in work points outside tool, make loops and add if new
//	tool, work..
//	tool:0, 1, 2	work:3, 4, 5	meeting:6, 7
//	polygons = ['8,-9 9,-9 9,-7', '7,-1 12,-8 7,-8']
//	polygons = ['8,-8 9,-8 9,-7', '7,-1 12,-8 7,-8']
//	polygons = ['10,-4 10,-5 8,-4.99999995', '7,-1 12,-5 7,-5']
//	polygons = ['10,-4 9,-5 8,-4', '7,-1 12,-5 7,-5']
//	polygons = ['7,-8 9,-3 14,-8', '7,-5 12,-5 7,-1']
//	polygons = ['14,-8 9,-3 7,-8', '7,-5 12,-5 7,-1']
//	polygons = ['14,-8 9,-3 7,-8', '7,-5 12,-5 7,-1']
//	polygons = ['7,-8 9,-5 14,-5.00000025', '7,-5 12,-5 7,-1']
//	polygons = ['5,-5.00000025 10,-5 12,-8', '7,-5 12,-5 7,-1']
//	polygons = ['8,-4 12,-5 12,-8', '7,-5 12,-5 7,-1']
//	polygons = ['8,-7 8,-4 11,-8', '7,-5 12,-5 7,-1']
//	polygons = ['8,-7 10,-5 11,-5', '7,-5 12,-5 7,-1']
//	polygons = ['8,-7 10,-4 12,-6', '7,-5 12,-5 7,-1']
//	polygons = ['8,-17 8,-7 12,-5', '7,-5 12,-5 7,-1']
//	polygons = ['12,-7 12,-3 15,-5', '7,-5 12,-5 7,-1']
//	polygons = ['8,-7 9,-9 9,-6', '7,-1 12,-8 7,-5']
//	polygons = ['8,-4 10,-7 11,-5', '7,-1 12,-5 7,-8']
//	polygons = ['6,-7 7,-3 7,-5 9,-5 10,-5 11,-8', '7,-5 12,-5 7,-1']
//	polygons = ['8,-7 8,-5 9,-5 10,-5 11,-7', '7,-5 8,-5 9,-5 10,-5 12,-5 7,-1']
//	polygons = ['8,-8 9,-8 9,-7', '7,-1 15,-8 11,-8 11,-7 12,-6 10,-6 11,-7 11,-8 7,-8']
//	polygons = ['8,-5 9,-5 9,-3', '7,-1 15,-8 12,-8 12,-7 8,-4 8,-6 12,-7 12,-8 7,-8']
//	var workPoints = '0,0 0,5 10,5 10,0'
//	var workPoints = '-2,4 2,4 2,0 -2,0'
	var workPoints = '0,-2 20,5 20,-2 14,-1 20,-2'
//	var workPoints = '0,-2 0,5 20,5 20,-2'
//	var workPoints = '7,0 8,6 15,0'
//	var workPoints = '7,0 8,7 15,0 7,0 9,3'
//	var toolPoints = '0,1 11,-1 11,3'
//	var toolPoints = '0,0 10,0 10,3 0,3'
//	var toolPoints = '5,-2 7,-2 7,-1'
//	var toolPoints = '12,-1 14,-1 12,0'
//	var toolPoints = '9,2 8,2 8,-5'
//	var toolPoints = '9,2 8,2 8,1'
//	var toolPoints = '2,0 2,2 -2,2 -2,0'
	var toolPoints = '15,-6 18,-6 18,1'
	var workPolygon = getPointsByString(workPoints)
	var toolPolygon = getPointsByString(toolPoints)
//	toolPolygon.reverse()
//	convertPointStringsToPointLists(polygons)
//	drawXYPolygons(polygons)
//	drawXYPolygon(toolPolygon)
//	console.log(getPolygonInsideness([0,-0.5], toolPolygon))
//	console.log('polygons')
//	console.log(polygons)
//	console.log(getPolygonInsideness([8,-7], polygons[0]))
//	console.log(getPolygonInsideness([8.1,-7], polygons[0]))
//	var operatedPolygons = getDifferencePolygons(toolPolygon, workPolygon)
	var operatedPolygons = getDifferencePolygons(toolPolygon, workPolygon)
//	var operatedPolygons = getDifferencePolygonsByPolygons([getPointsByString('15,-6 18,-6 18,1')], [workPolygon])
	console.log('operatedPolygons')
	console.log(operatedPolygons)
	drawXYPolygons(operatedPolygons)
}

function testTaper() {
	console.log('testTaper')
//	var pointString = '0,-4,0 4,3,0 8,-4,0'
	var pointString = '0,-4,0 4,2.92820323,0 8,-4,0'
	var polygon3D = getPointsByString(pointString)
	var heights = [0.0, 1.0]
	var mesh = {facets:[], points:[]}
	addToPillarMesh(heights, mesh, polygon3D)
	var pillarMesh = getPillarMesh(heights, [polygon3D], getUnitMatrix3D())
//	drawMesh(pillarMesh)
	console.log('pillarMesh points')
	console.log(pillarMesh.points)
	console.log(pillarMesh.facets)
	taperMesh(getUnitMatrix3D(), 2.0, 40.0, 15.5, pillarMesh)
	drawMesh(pillarMesh)
}

function testTransform() {
	console.log('testTransform')
	var parent = getStatementByParentTag(new Map([['comment', 'true']]), 1, undefined, 'g')
	var value = 'translate(2,(3))scale(1,2)'
	var registry = {dataMap:new Map(), idMap:new Map(), meshMap:new Map()}
	var statement = getStatementByParentTag(new Map([['transform', value]]), 1, parent, 'g')
	console.log(statement.attributeMap)
	console.log(getBracketSeparatedWords(statement.attributeMap.get('transform')))
	var matrix = getMatrix2D(registry, statement)
	console.log('matrix')
	console.log(matrix)
	console.log(statement)
}

function testTransforms() {
	console.log('testTransforms')
	var parent = getStatementByParentTag(new Map([['comment', 'true']]), 1, undefined, 'g')
//	var value = 'rotate3D(0,0,1,index*5) heights=0,1,2'
//	var value = 'rotate(index*9) heights=0,1,2'
//	var value = 'stair(0,-1,(2+1) 2,-3,4 4,-5,6)'
//	var value = 'path(0,-1,3 2,-3,4 4,-5,6)'
//	var value = 'path(0,-1,3 2,-3,4)'
	var value = 'path(0,0,0 0,-.5,3 0,0,6)'
	var registry = {dataMap:new Map(), idMap:new Map(), meshMap:new Map()}
	var statement = getStatementByParentTag(new Map([['transforms', value]]), 1, parent, 'g')
	console.log(getBracketSeparatedWords(statement.attributeMap.get('transforms')))
	var matrices = getMatrices3DAndZeroHeight(registry, statement, null)
	console.log('matrices')
	console.log(matrices)
	console.log(statement)
	var layers = []
	var polynodes = [[{point:[0, 0]}, {point:[0, 5]}, {point:[10, 0]}]]
	layers.push({connection:'s', height:0, matrix:matrices[0], polynodes:polynodes, transform3D:null})
	polynodes = [[{point:[0, 0]}, {point:[0, 5]}, {point:[10, 0]}]]
	layers.push({connection:'s', height:2, matrix:matrices[1], polynodes:polynodes, transform3D:null})
	polynodes = [[{point:[0, 0]}, {point:[0, 5]}, {point:[10, 0]}]]
	layers.push({connection:'s', height:4, matrix:matrices[2], polynodes:polynodes, transform3D:null})
	var sculptureMesh = getSculptureMesh(layers, getUnitMatrix3D())
	console.log(layers)
	console.log(sculptureMesh)
	drawMesh(sculptureMesh)
}

function testTriangulate() {
	console.log('testTriangulate')
//	var pointString = '0,0,0 0,4,0 4,4,0 4,0,0'
//	var pointString = '0,0,0 0,4,0 4,4,0 1,2,0 4,0,0'
//	var pointString = '0,0,0 0,4,0 4,4,0 4,3,0 1,3,0 1,1,0 4,1,0 4,0,0'
//	var pointString = '-10,0,0 -10,4,0 8,4,0 24,5,0 24,3,0 1,3,0 1,1,0 24,1,0 24,-1,0 8,0,0'
//	var pointString = '-10,0 -10,4 8,4 8,4 24,5 24,3 1,3 1,1 24,1 24,-1 8,0'
//	var pointString = '-10,-30,0 -10,0,0 -20,0,0 -20,-9,0 -20,-21,0 -20,-30,0'
//	var pointString = '39,-30,0, 17,-30,0, 14,-23,0, 14,-11,0, 17,-4,0, 0,0,0, 0,-34,0, 2,-30,0, 2,-4,0, 12,-4,0, 12,-30,0, 2,-30,0'
//	var pointString = '39,-30,0, 17,-30,0, 14,-23,0, 14,-11,0, 17,-4,0, 0,0,0, 0,-34,0, 2,-30,0, 2,-4,0, 12,-4,0, 12,-30,0, 2,-30,0'
//	var pointString = '34,0,95 34,39,95 30,39,95 30,17,95 23,14,95 11,14,95 4,17,95 4,39,95 0,39,95 0,0,95 34,0,95 30,2,95 4,2,95 4,12,95 30,12,95 30,2,95'
//	var pointString = '-1.5,10.25 -2.5,10.45 -2.5,12.05 -1.5,12.25 1,12.25 1,-12.25 -1.5,-12.25 -2.5,-12.05 -2.5,-10.45 -1.5,-10.25 -1,-10.25 -1,-8.25 -8.333333333333334,-8.25 -8.333333333333334,-10.25 -7.833333333333334,-10.25 -6.833333333333334,-10.45 -6.833333333333334,-12.05 -7.833333333333334,-12.25 -10.833333333333334,-12.25 -11.833333333333334,-12.05 -11.833333333333334,-10.45 -10.833333333333334,-10.25 -10.333333333333334,-10.25 -10.333333333333334,-8.25 -17.666666666666668,-8.25 -17.666666666666668,-10.25 -17.166666666666668,-10.25 -16.166666666666668,-10.45 -16.166666666666668,-12.05 -17.166666666666668,-12.25 -20.166666666666668,-12.25 -21.166666666666668,-12.05 -21.166666666666668,-10.45 -20.166666666666668,-10.25 -19.666666666666668,-10.25 -19.666666666666668,-8.25 -27,-8.25 -27,-10.25 -26.5,-10.25 -25.5,-10.45 -25.5,-12.05 -26.5,-12.25 -29,-12.25 -29,-2.25 -4,-2.2500000000000018 -3,-2.450000000000002 -3,-4.050000000000002 -4,-4.250000000000002 -27,-4.25 -27,-6.25 -1,-6.25 -1,6.25 -27,6.25 -27,1.75 -4,1.7499999999999982 -3,1.549999999999998 -3,-0.05000000000000182 -4,-0.2500000000000018 -29,-0.25 -29,12.25 -26.5,12.25 -25.5,12.05 -25.5,10.45 -26.5,10.25 -27,10.25 -27,8.25 -19.666666666666668,8.25 -19.666666666666668,10.25 -20.166666666666668,10.25 -21.166666666666668,10.45 -21.166666666666668,12.05 -20.166666666666668,12.25 -17.166666666666668,12.25 -16.166666666666668,12.05 -16.166666666666668,10.45 -17.166666666666668,10.25 -17.666666666666668,10.25 -17.666666666666668,8.25 -10.333333333333334,8.25 -10.333333333333334,10.25 -10.833333333333334,10.25 -11.833333333333334,10.45 -11.833333333333334,12.05 -10.833333333333334,12.25 -7.833333333333334,12.25 -6.833333333333334,12.05 -6.833333333333334,10.45 -7.833333333333334,10.25 -8.333333333333334,10.25 -8.333333333333334,8.25 -1,8.25 -1,10.25'
//	var pointString = '14.5,-8.444 14.5,-7.556 14.721,-6.697 4.2997705206102536e-16,4.6655377184173457e-17 4.2997705206102536e-16,-39 95,-39 95,4.6655377184173457e-17 4.2997705206102536e-16,4.6655377184173457e-17 14.721,-6.697 15.15,-5.921 15.759,-5.276 16.509,-4.803 17.354,-4.532 18.239,-4.48 19.11,-4.651 19.91,-5.034 21.857,-6.668 21.857,-9.332 19.91,-10.966 19.11,-11.349 18.239,-11.52 17.354,-11.468 16.509,-11.197 15.759,-10.724 15.15,-10.079 14.721,-9.303 14.5,-8.444 11.857,-9.332 9.91,-10.966 9.11,-11.349 8.239,-11.52 7.353999999999999,-11.468 6.509,-11.197 5.759,-10.724 5.15,-10.079 4.721,-9.303 4.5,-8.444 4.5,-7.556 4.721,-6.697 5.15,-5.921 5.759,-5.276 6.509,-4.803 7.353999999999999,-4.532 8.239,-4.48 9.11,-4.651 9.91,-5.034 11.857,-6.668 11.857,-9.332'
//	var pointString = '9,13,24 13,13,24 13,9,24 17,9,24 17,13,24 21,13,24 21,17,24 17,17,24 17,21,24 13,21,24 13,17,24 9,17,24'
//	var pointString = '13,-9 13,-13 9,-13 9,-17 13,-17 13,-21 17,-21 17,-17 21,-17 21,-13 17,-13 17,-9'
//	var pointString = '6.5,17.5 4.5,17.5 4.5,15.5 6.5,15.5 8.5,15.5 10.5,15.5 10.5,17.5 8.5,17.5'
//	var pointString = '-24,0 -30,0 -30,-50 -24,-50 -24,-40 24,-40 24,-50 30,-50 30,0 24,0 24,-10 -24,-10 -24,0 -24,-30 -24,-20 24,-20 24,-30 -24,-30'
//	var pointString = '24,0 30,0 30,50 24,50 24,40 -24,40 -24,50 -30,50 -30,0 -24,0 -24,10 24,10 24,0 24,30 24,20 -24,20 -24,30 24,30'
//	var pointString = '-24.400000000000006,-224 -96.93096831535877,-215 -97.20591390266026,-217.08841907552085 -98.01201357715915,-219.03451584232062 -99.29433297818109,-220.7056670218189 -100.96548415767938,-221.98798642284083 -102.91158092447918,-222.79408609733974 -105,-223.06903168464123 -107.08841907552082,-222.79408609733974 -109.0345158423206,-221.98798642284083 -110.70566702181891,-220.7056670218189 -111.98798642284085,-219.03451584232062 -112.79408609733974,-217.0884190755208 -113.06903168464122,-215 -112.79408609733974,-212.91158092447915 -111.98798642284085,-210.96548415767938 -110.70566702181893,-209.29433297818105 -109.0345158423206,-208.01201357715917 -107.08841907552082,-207.20591390266026 -105,-206.93096831535877 -102.91158092447917,-207.20591390266026 -100.96548415767938,-208.01201357715917 -99.29433297818107,-209.29433297818105 -98.01201357715915,-210.96548415767938 -97.20591390266026,-212.91158092447915 -96.93096831535877,-215 -24.400000000000006,-224 -24.400000000000006,-183.99999999999994 -185.60000000000002,-184 -185.60000000000002,-224 -24.400000000000006,-224 -29.400000000000006,-221 -37.400000000000006,-204 -29.400000000000006,-187 -29.400000000000006,-221'
//	var pointString = '-37.898102010146246,-221.82508898043224 -96.93096831535877,-214.5 -97.20591390266026,-216.58841907552085 -98.01201357715915,-218.53451584232062 -99.29433297818109,-220.20566702181893 -100.96548415767938,-221.48798642284086 -102.91158092447918,-222.29408609733974 -105,-222.56903168464123 -107.08841907552082,-222.29408609733974 -109.0345158423206,-221.48798642284083 -110.70566702181891,-220.20566702181893 -111.98798642284085,-218.53451584232062 -112.79408609733974,-216.58841907552082 -113.06903168464122,-214.5 -112.79408609733974,-212.41158092447918 -111.98798642284085,-210.46548415767938 -110.70566702181893,-208.79433297818107 -109.0345158423206,-207.51201357715917 -107.08841907552082,-206.70591390266026 -105,-206.43096831535877 -102.91158092447917,-206.70591390266026 -100.96548415767938,-207.51201357715917 -99.29433297818107,-208.79433297818107 -98.01201357715915,-210.46548415767938 -97.20591390266026,-212.41158092447918 -96.93096831535877,-214.5 -37.898102010146246,-221.82508898043224 -47.400000000000006,-203.5 -33.400000000000006,-185.5 -33.400000000000006,-222.38323564566494 -24.400000000000006,-223.50000000000003 -24.400000000000006,-183.49999999999997 -185.60000000000002,-183.5 -185.60000000000002,-223.50000000000003 -37.029629629629625,-223.50000000000003 -37.898102010146246,-221.82508898043224 -47.400000000000006,-203.5 -33.400000000000006,-185.5 -33.400000000000006,-222.38323564566494 -33.400000000000006,-223.50000000000003 -24.400000000000006,-223.50000000000003'
//	var pointString = '-72.69416058394161,-97.75 -69.3,-91.75 -69.3,-79.5496577882578 -69.68161199515768,-78.48744000586944 -75.55892007564165,-71.36343021134343 -75.9349419813431,-70.41517375495249 -76.5125,-61.57499999999999 -76.95,-52.19999999999999 -77.21249999999999,-42.82499999999999 -77.29454342062846,-34.03463350409387 -77.88465896757641,-33.449999999999996 -78.71421356237309,-33.449999999999996 -79.3,-34.0357864376269 -79.3,-44.05 -79.3,-48.05 -79.3,-68.57815538347683 -80.16815538347683,-70.08184461652314 -81.67184461652316,-70.94999999999999 -81.67184461652316,-74.94999999999999 -80.16815538347683,-75.81815538347682 -79.3,-77.32184461652315 -79.3,-83.35 -79.3,-87.35 -79.3,-94.37815538347684 -80.16815538347683,-95.88184461652315 -81.67184461652316,-96.75 -93.32815538347683,-96.75 -94.83184461652316,-95.88184461652315 -95.7,-94.37815538347684 -95.7,-88.75 -100.19999999999999,-88.75 -101.69999999999999,-87.28518375848799 -101.69999999999999,-83.41481624151199 -100.19999999999999,-81.94999999999999 -95.69999999999999,-81.94999999999999 -95.69999999999999,-77.32184461652315 -94.83184461652316,-75.81815538347682 -93.32815538347683,-74.94999999999999 -81.67184461652316,-74.94999999999999 -81.67184461652316,-70.94999999999999 -93.32815538347683,-70.94999999999999 -94.83184461652316,-70.08184461652314 -95.7,-68.57815538347683 -95.69999999999999,-48.05 -95.69999999999999,-44.05 -95.69999999999999,-34.0357864376269 -96.2857864376269,-33.449999999999996 -97.11534103242359,-33.449999999999996 -97.70545657937154,-34.03463350409387 -97.7875,-42.82499999999999 -98.05,-52.19999999999999 -98.4875,-61.57499999999999 -99.06505801865688,-70.41517375495249 -99.44107992435833,-71.36343021134343 -105.37647847436608,-78.5578526962013 -105.74783741165703,-79.45611981533133 -107.47693761814745,-97.75'
//	var pointString = '-69.68161199515768,-78.48744000586944 -75.55892007564165,-71.36343021134343 -75.9349419813431,-70.41517375495249 -76.5125,-61.57499999999999 -76.95,-52.19999999999999 -77.21249999999999,-42.82499999999999 -77.29454342062846,-34.03463350409387 -77.88465896757641,-33.449999999999996 -78.71421356237309,-33.449999999999996 -79.3,-34.0357864376269 -79.3,-44.05 -79.3,-48.05 -79.3,-68.57815538347683 -80.16815538347683,-70.08184461652314 -81.67184461652316,-70.94999999999999 -81.67184461652316,-74.94999999999999 -80.16815538347683,-75.81815538347682 -79.3,-77.32184461652315 -79.3,-83.35 -79.3,-87.35 -79.3,-94.37815538347684 -80.16815538347683,-95.88184461652315 -81.67184461652316,-96.75 -93.32815538347683,-96.75 -94.83184461652316,-95.88184461652315 -95.7,-94.37815538347684 -95.7,-88.75 -100.19999999999999,-88.75 -101.69999999999999,-87.28518375848799 -101.69999999999999,-83.41481624151199 -100.19999999999999,-81.94999999999999 -95.69999999999999,-81.94999999999999 -95.69999999999999,-77.32184461652315 -94.83184461652316,-75.81815538347682 -93.32815538347683,-74.94999999999999 -81.67184461652316,-74.94999999999999 -81.67184461652316,-70.94999999999999 -93.32815538347683,-70.94999999999999 -94.83184461652316,-70.08184461652314 -95.7,-68.57815538347683 -95.69999999999999,-48.05 -95.69999999999999,-44.05 -95.69999999999999,-34.0357864376269 -96.2857864376269,-33.449999999999996 -97.11534103242359,-33.449999999999996 -97.70545657937154,-34.03463350409387 -97.7875,-42.82499999999999 -98.05,-52.19999999999999 -98.4875,-61.57499999999999 -99.06505801865688,-70.41517375495249 -99.44107992435833,-71.36343021134343 -105.37647847436608,-78.5578526962013'
	var pointString = '76,-70 76,-72 74,-72 74,-86 104,-86 104,-26 74,-26 74,-40 76,-40 83,-35 86.5,-35 86.5,-34 86.5,-31 91.5,-31 91.5,-34 91.5,-35 95,-35 95,-47 91.5,-47 91.5,-48 91.5,-51 86.5,-51 86.5,-48 86.5,-47 83,-47 83,-35 76,-40 76,-42 76,-70 83,-65 86.5,-65 86.5,-64 86.5,-61 91.5,-61 91.5,-64 91.5,-65 95,-65 95,-77 91.5,-77 91.5,-78 91.5,-81 86.5,-81 86.5,-78 86.5,-77 83,-77 83,-65'
//	var pointString = '136,-35 134,-23 76,-23 73.99999999999996,-35 74.00000000000003,-56.99999999999997 76,-69 79.14359353944897,-69 82.85640646055101,-71.14359353944897 85,-74.85640646055103 82.99999999999999,-217 82.99999999999999,-223.57439780373045 83.98697564639414,-221.2936725606235 85.79857345141995,-219.59251355748881 92.99999999999999,-217 87.39999999999999,-207.6315789473684 90.40000000000002,-27 119.6,-27 122.6,-207.6315789473684 87.39999999999999,-207.6315789473684 92.99999999999999,-217 116.99999999999999,-217 124.20142654858002,-219.59251355748881 126.01302435360583,-221.2936725606235 126.99999999999999,-223.57439780373045 126.99999999999999,-217 125,-74.85640646055103 127.14359353944897,-71.14359353944897 130.856406460551,-69 134,-69 136,-57'
	var points = getPointsByString(pointString)
//	var facet = [4, 3, 2, 1, 0]
//	var facet = [0, 1, 2, 3, 4, 5, 6, 7]
//	var facet = [0, 1, 2, 3, 4, 5]
//	var facet = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
	var facetVertexIndexes = getFacetVertexIndexes(points)
	console.log(facetVertexIndexes)
	var facet = []
	var pointStringMap = new Map()
	for (var pointIndex = 0; pointIndex < points.length; pointIndex++) {
		if (points[pointIndex].length == 2) {
			points[pointIndex].push(0.0)
		}
		var pointString = points[pointIndex].toString()
		if (pointStringMap.has(pointString)) {
			facet.push(pointStringMap.get(pointString))
		}
		else {
			facet.push(pointStringMap.size)
			pointStringMap.set(pointString, pointStringMap.size)
		}
	}
	for (var entry of pointStringMap.entries()) {
		points[entry[1]] = entry[0].split(',').map(parseFloat)
	}
	console.log(facet)
	var concaveFacets = getConcaveFacets(facet.slice(0), points)
	var xyTriangleFacets = getXYTriangleFacets(facet, points)
	var triangles = getPolygonsByFacets(xyTriangleFacets, points)
	add2Ds(points, [0,60])
	multiply3DsByScalar(points, 0.2)
//	drawXYPolygon(getPolygonByFacet(facet, points), getRGB())
	var concavePolygons = getPolygonsByFacets(concaveFacets, points)
	for (var triangle of triangles) {
		if (getNormalByPolygon(triangle) == null) {
			console.log('too thin triangle')
			console.log(triangle)
		}
	}
	var arrowsMap = getArrowsMap(xyTriangleFacets)
	var multiples = []
	for (var arrows of arrowsMap.values()) {
		if (arrows.length > 1) {
			multiples.push(arrows)
		}
	}
	console.log(xyTriangleFacets)
	console.log(concavePolygons)
	console.log(multiples)
	drawXYInsetPolygons(concavePolygons, 0.05)
//	drawXYInsetPolygons(triangles, 0.05)
	return
	console.log(triangleFacets)
//	rotateXYZParametersByPoints(1, points)
	var triangleFacets = getTriangle3DFacets(facet, points, new Array(points.length))
	var triangles = getPolygonsByFacets(triangleFacets, points)
//	rotateXYZParametersByPoints(-1, points)
	console.log('triangles')
	console.log(triangles)
	console.log(points)
	drawXYPolygons(triangles)
	var lastTriangle = triangles[triangles.length - 1]
	add2Ds(lastTriangle, [2, 0.0])
//	drawXYPolygon(lastTriangle, getRGB())
}

function testVoxel() {
	var lines = []
	var pointMap = new Map()
	var tipMap = new Map()
	var voxelMap = new Map()
	addTestVoxels(voxelMap)
	createTips(voxelMap)
	addVoxelLines(2, voxelMap, lines, pointMap, tipMap)
	addVoxelLines(0, voxelMap, lines, pointMap, tipMap)
	addVoxelLines(1, voxelMap, lines, pointMap, tipMap)
//	drawVoxelMap(voxelMap)
//	drawLines(lines, pointMap)
	var mesh = getMeshByTipMap(pointMap, tipMap)
//	drawMesh(mesh)
	mesh = getPolygonateMesh(mesh)
	drawMesh(mesh)
	drawXYZPoints(mesh.points)
}

function testVoxelBoolean() {
//	var lines = []
//	var pointMap = new Map()
//	var tipMap = new Map()
	var pointString = '0,0,0 4,0,0 0,0,4 0,4,0'
//	var pointString = '0,0,0 4,0,0 0,0,3 0,4,0'
//	var pointString = '0,1,0 2,1,0 0,1,1 0,2,0'
	var points = getPointsByString(pointString)
	var mesh = {facets:[[0, 1, 2], [0, 2, 3], [1, 3, 2], [0, 3, 1]], points:points}
	var lattice = getXYZLatticeByMesh(mesh)
//	var voxelMap = getVoxelMapByXYZLattice(xyzLattice)
//	addVoxelLines(2, voxelMap, lines, pointMap, tipMap)
//	addVoxelLines(0, voxelMap, lines, pointMap, tipMap)
//	addVoxelLines(1, voxelMap, lines, pointMap, tipMap)
//	mesh = getMeshByTipMap(pointMap, tipMap)
//	mesh = getPolygonateMesh(mesh)
	mesh = getMeshByLattice(lattice)
//	drawMesh(mesh)
	var linesB = []
	var pointMapB = new Map()
	var tipMapB = new Map()
	var pointStringB = '0,-1,0 6,-1,0 0,-1,4 0,4,0'
//	var pointStringB = '0,-1,0 6,-1,0 0,-1,3 0,4,0'
//	var pointStringB = '0,0,0 6,0,0 0,0,4 0,4,0'
//	var pointStringB = '0,0,0 4,0,0 0,0,1 0,2,0'
	var pointsB = getPointsByString(pointStringB)
	add2Ds(pointsB, [1, 0])
	var meshB = {facets:[[0, 1, 2], [0, 2, 3], [1, 3, 2], [0, 3, 1]], points:pointsB}
	var latticeB = getXYZLatticeByMesh(meshB)
	var voxelMapB = getVoxelMapByXYZLattice(latticeB)
	addVoxelLines(2, voxelMapB, linesB, pointMapB, tipMapB)
	addVoxelLines(0, voxelMapB, linesB, pointMapB, tipMapB)
	addVoxelLines(1, voxelMapB, linesB, pointMapB, tipMapB)
	meshB = getMeshByTipMap(pointMapB, tipMapB)
	meshB = getPolygonateMesh(meshB)
//	drawMesh(meshB)
//	var latticeC = getXYZLatticeAddition(lattice, latticeB)
//	var latticeC = getXYZLatticeExclusiveIntersection(lattice, latticeB)
	var latticeC = getXYZLatticeIntersection(lattice, latticeB)
//	var latticeC = getXYZLatticeSubtraction(lattice, latticeB)
	var linesC = []
	var pointMapC = new Map()
	var tipMapC = new Map()
	var voxelMapC = getVoxelMapByXYZLattice(latticeC)
	drawVoxelMap(voxelMapC)
	addVoxelLines(2, voxelMapC, linesC, pointMapC, tipMapC)
	addVoxelLines(0, voxelMapC, linesC, pointMapC, tipMapC)
	addVoxelLines(1, voxelMapC, linesC, pointMapC, tipMapC)
//	drawLines(linesC, pointMapC)
	var meshC = getMeshByTipMap(pointMapC, tipMapC)
	meshC = getPolygonateMesh(meshC)
	drawMesh(meshC)
//	console.log(getMeshAnalysis(meshC))
}

function writeLengths(characters, numberLength) {
	var line = ''
	document.writeln('<g font-family=freeserif,Palatino font-size="1000" font-weight="normal" id="group" style="fill:black;stroke:black;stroke-width:0.0">')
	for (var character of characters) {
		var textLength = getSVGTextLength(character)
		line += character + ' ' + textLength + ' '
		numberLength.totalLength += textLength
	}
	numberLength.totalGroupLength += getSVGTextLength(characters.join(''))
	console.log(line)
	console.log(numberLength.totalLength / numberLength.totalGroupLength)
	numberLength.numberOfCharacters += characters.length
	document.writeln('</g>')
}

function createSVGTest() {
	document.writeln('<svg height="1100" width="1600">')
	document.writeln('<defs>')
	document.writeln('<marker id="arrowhead" markerWidth="20" markerHeight="14" refX="10" refY="3.5" orient="auto">')
	document.writeln('<polygon points="0 0, 20 7, 0 14" />')
	document.writeln('</marker>')
	document.writeln('</defs>')
	document.writeln('<g style="fill:none;stroke:rgb(0,0,0);stroke-width:0.01" transform="matrix(50,0,0,-50,300,300)">')
	var before = new Date().getTime()
//	testBend()
//	testBevel()
//	testConnectedFacet()
//	testDrillByMesh()
//	testDrillByPolygon()
//	testExpand()
//	testEquation()
//	testExtrusion()
//	testFace()
//	testFacetSubtraction()
//	testFence()
//	testFillet()
//	testFormattedText()
//	testIntercircle()
//	testJoin()
	testLength()
//	testLettering()
//	testLinkMap()
//	testLoop()
//	testMeshBoolean()
//	testMirrorJoin()
//	testOutline()
//	testOutset()
//	testOverlap()
//	testPixelBoolean()
//	testPolygonate()
//	testPolygonBoolean()
//	testPolygonGroups()
//	testPolygonJoining()
//	testRemoveTooThinFacets()
//	testRoad()
//	testSculptureVertical()
//	testSplitPoints()
//	testSplitPolygon()
//	testSubtraction()
//	testTaper()
//	testTransform()
//	testTransforms()
//	testTriangulate()
//	testVoxel()
//	testVoxelBoolean()
//	testWedge()
//	console.log('Execution time')
//	console.log(new Date().getTime() - before)
	document.writeln('</g>')
	document.writeln('</svg><br>')
}

createSVGTest()
</script>
</body>
</html>

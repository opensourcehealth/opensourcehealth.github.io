<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Wordscape</title>
</head>
<body>
<table style="width:60%">
<tr>
<td style="width:15%"><button onclick="toggleFile()" type="button">File</button><td>
<td><button onclick="toggleEdit()" type="button">Edit</button><td>
<td><button onclick="toggleView()" type="button">View</button><td>
</tr>
<tr>
<td style="width:15%"><button hidden="true" id="newWindowButtonID" onclick="newWindow()" type="button">New</button><td>
<td><button hidden="true" id="undoButtonID" type="button" onclick="undo()">Undo</button><td>
<td><select hidden="true" id="viewSelectID" onchange ="viewSelectChanged()"></select><td>
</tr>
<tr>
<td><input hidden="true" type="file" id="browseID" onchange="browse(this)"/><td>
<td><button hidden="true" id="redoButtonID" type="button" onclick="redo()">Redo</button><td>
<td><select hidden="true" id="typeSelectID" onchange ="typeSelectChanged()"></select></td>
</tr>
<tr>
<td><button hidden="true" id="loadLastSessionButtonID" onclick="loadLastSession()" type="button">Load Last Session</button><td>
<td><select hidden="true" id="querySelectID" onchange ="querySelectChanged()"></select><td>
<td><select hidden="true"></select><td>
</tr>
<tr>
<td><select hidden="true" id="loadASessionID" onchange ="loadASessionChanged()"></select><td>
<td><a hidden="true" id="queryLinkID" href="index.html">Original Link</a><td>
<td><select hidden="true"></select><td>
</tr>
<tr>
<td><button hidden="true" id="saveButtonID" onclick="save()" type="button">Save</button></td>
<td><select hidden="true"></select><td>
<td><select hidden="true"></select><td>
</tr>
</table>
<table>
<tr>
<th><canvas id="viewerCanvas" width="0" height="0" style="border:1px solid black"></canvas></th><th id="paragraphText"></th>
</tr>
</table>
<table>
<tr>
<td><button type="button" onclick="update()">Update</button><td>
<td><select hidden="true"></select><td>
<td><select hidden="true"></select><td>
</tr>
</table>
<textarea id="wordAreaID" rows="20" cols="120"></textarea><br>
<br>
<h3>SVG</h3>
<textarea id="svgArea" rows="40" cols="120"></textarea><br>
<br>
<h3>STL Input</h3>
<textarea id="stlInputID" rows="4" cols="120"></textarea><br>
<br>
<script src="arraymath.js"></script>
<script src="maparray.js"></script>
<script src="alteration.js"></script>
<script src="construction.js"></script>
<script src="codec.js"></script>
<script src="evaluation.js"></script>
<script src="filesaver.js"></script>
<script src="function.js"></script>
<script src="help.js"></script>
<script src="generator2d.js"></script>
<script src="generator3d.js"></script>
<script src="lzstring.js"></script>
<script src="matrix.js"></script>
<script src="meta.js"></script>
<script src="parsenumber.js"></script>
<script src="parseword.js"></script>
<script src="pixel.js"></script>
<script src="polygon.js"></script>
<script src="polyhedron.js"></script>
<script src="statement.js"></script>
<script src="viewbroker.js"></script>
<script src="viewfractal2d.js"></script>
<script src="viewmesh.js"></script>
<script src="voxel.js"></script>
<script>
//License = GNU Affero General Public License http://www.gnu.org/licenses/agpl.html
//
//change exterior to voxel and pixel
//verticalHole should be widdershins, all widdershins should be reversed when making a mesh when on outside
//view transform3D
//hidden lines
//sculpture mosaics=[{transform,[surfacets]}], closed surfacet={indegons, bottom, top} indegon can be indexed x,y,z;index,id,polygonIndex
//slice svg=id layerThickness=0.6 viewer=none/basic layerHeights=none/[]
//combination id=a+b-c#d!#e*f/g ** h on vertex
//add circles and rect to bounding box
//check backslash quote in quoteSeparated
//codeStyle indentation start increment type groupDelimeter
//wireframe/solid choice, instructions, 3D direction display, settings, wait, animation, separate polygons option
//set descendants depth with statement
//extrusion sort closest before splicing if they are both on same edge arrowindexsetmap only needed with thin shapes
//transform3D extrusionPath(heights, polyline, polygon, polyplane)
//mirror line y and vector, polyrect
//setLocal, setGlobal, if switch case else, for
//outset, shell, tile, venturi, helix, unlimited, terrain, road
//gear/wheel, wing, propeller, pipe/pail, pulley/cable, chair/shelf, gores?, lattice?, haxagonal extrusion
//humanoid, quadruped, door/window, lamp/chandelier, gemstone, press, arch, column, pontoon, box, shoe/hat, ribs/umbrella, house
//wrench/screwdriver, alteration machine
//document.getElementById("wordArea").onkeydown = function(evt) {(evt) ? evt : window.event if (evt.keyCode == 13) {alert("e");}}
//textArea.value.slice(0, textArea.selectionStart).split('\n').length - 1
//deprecated flip
/*
lastKeyDownCode = null
areaKeyDown = function(evt) {
    (evt) ? evt : window.event
    lastKeyDownCode = evt.keyCode
}

areaInput = function(evt) {
    if (lastKeyDownCode == 13) {
    lines=wordArea.value.split("\n")
    lines[getLineNumber(wordArea)] = '    '
   wordArea.value = lines.join('\n')
    }
}
wordArea.onkeydown = areaKeyDown
wordArea.oninput = areaInput
*/

function addOutputArea(text, title) {
	if (getIsEmpty(text)) {
		return
	}
	var textAreaID = 'output_area_' + title
	var textArea = document.getElementById(textAreaID)
	if (textArea == null) {
		var heading = document.createElement('H3')
		heading.appendChild(document.createTextNode('Output - ' + title))
		document.body.appendChild(heading)
		textArea = document.createElement('textarea')
		textArea.cols = 120
		textArea.id = textAreaID
		textArea.rows = 4
		textArea.value = text
		document.body.appendChild(textArea)	
	}
	else {
		textArea.value = text
	}
}

function updateSVGArea(lines) {
}

function updateWordArea(wordString) {
	var lines = getBracketReplacedLinesByText(wordString)
	var paragraphTextElement = document.getElementById('paragraphText')

	var registry = {dataMap:new Map(), generatedIDSet:new Set(), idMap:new Map(), meshMap:new Map(), views:[]}
	var svgStatement = getDocumentRoot(lines, 'svg')
	if (svgStatement == undefined) {
		paragraphTextElement.innerHTML = ''
		paragraphTextElement.hidden = true
		return ''
	}
	var descendants = [svgStatement]
	addToDescendantsOutsideFirst(descendants, svgStatement)
	for (var statement of descendants) {
		if (statement.tag != null) {
			getStatementID(registry, statement)
		}
	}
	createDefault(registry, svgStatement)
	descendants = [svgStatement]
	addToDescendantsInsideFirst(descendants, svgStatement)
//	var before = new Date().getTime()
	processDescendantsByTagMap(registry, svgStatement, gTagCenterMap)
//	console.log('Execution time')
//	console.log(new Date().getTime() - before)
//	var lineThickness = 10
	var boundingBox = getGroupBoundingBox(null, registry, svgStatement)
	var height = null
	var width = null
	var heightSuffix = ''
	var widthSuffix = ''
	if (svgStatement.attributeMap.has('height')) {
		var heightString = svgStatement.attributeMap.get('height')
		heightSuffix = getAlphabeticSuffix(heightString)
		height = parseFloat(heightString)
	}
	if (svgStatement.attributeMap.has('width')) {
		var widthString = svgStatement.attributeMap.get('width')
		widthSuffix = getAlphabeticSuffix(widthString)
		width = parseFloat(widthString)
	}
	var padding = 5
	var doublePadding = 2 * padding
	if (height == null) {
		if (boundingBox != null) {
			height = boundingBox[1][1] + doublePadding
		}
	}
	if (width == null) {
		if (boundingBox != null) {
			width = boundingBox[1][0] + doublePadding
		}
	}
	if (height != null) {
		svgStatement.attributeMap.set('height', height.toFixed() + heightSuffix)
	}
	if (width != null) {
		svgStatement.attributeMap.set('width', width.toFixed() + widthSuffix)
	}
	if (!svgStatement.attributeMap.has('style')) {
		svgStatement.attributeMap.set('style', 'border:1px solid black;padding:' + padding.toString() + 'px')
	}
	if (!svgStatement.attributeMap.has('xmlns')) {
		svgStatement.attributeMap.set('xmlns', 'http://www.w3.org/2000/svg')
	}
	var svgLines = getPassthroughLinesByStatement('svg', svgStatement)
	var joinWord = getJoinWord()
	var svgString = svgLines.join(joinWord)
	setNumberOfRows('wordAreaID', lines)
	setNumberOfRows('svgArea', svgLines)
	document.getElementById('svgArea').value = svgString
	if (height == null || width == null) {
		paragraphTextElement.hidden = true
	}
	else {
		paragraphTextElement.hidden = false
		paragraphTextElement.innerHTML = svgString
	}
	if (height == null) {
		height = 0
	}
	else {
		height += doublePadding
	}
	document.getElementById('viewerCanvas').hidden = registry.views.length == 0
	if (registry.views.length > 0) {
		viewBroker.start(Math.max(height, viewBroker.minimumHeight), 'viewerCanvas', registry)
	}
}

var gParentFirstSet = new Set()
var gTagCenterMap = new Map()
gProcessors = gAlterationProcessors.concat(gConstructionProcessors).concat(gGenerator2DProcessors)
gProcessors = gProcessors.concat(gGenerator3DProcessors).concat(gMetaProcessors)
initializeProcessors(gProcessors)

setTextArea('wordAreaID')
update()
</script>
</body>
</html>
